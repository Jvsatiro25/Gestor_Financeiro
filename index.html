<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel de GestÃ£o Financeira</title>
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; overflow: hidden; }
        .navbar { background: white; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .nav-group, .filter-group { display: flex; gap: 10px; align-items: center; }
        .nav-btn { padding: 10px 18px; cursor: pointer; border: 1px solid #e2e8f0; background: #fff; border-radius: 8px; font-weight: 600; color: #64748b; }
        .nav-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
        select { padding: 8px 12px; border-radius: 8px; border: 1px solid #cbd5e1; background: #f8fafc; cursor: pointer; font-weight: 500; }
        iframe { width: 100%; height: calc(100vh - 72px); border: none; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-group">
            <button class="nav-btn active" onclick="mudarAba('planilha.html', this, true)">ðŸ“‹ Planilha</button>
            <button class="nav-btn" onclick="mudarAba('grafico.html', this, false)">ðŸ“Š GrÃ¡fico</button>
            <button class="nav-btn" onclick="mudarAba('membros.html', this, true)">ðŸ‘¥ Membros</button>
        </div>

        <div class="filter-group">
            <select id="filtroCat" onchange="enviarFiltros()">
                <option value="Todas">Todas Categorias</option>
                <option value="Oferta">Oferta</option>
                <option value="DÃ­zimo">DÃ­zimo</option>
                <option value="Malawi">Malawi</option>
                <option value="Campanha">Campanha</option>
            </select>

            <select id="filtroPeriodo" onchange="enviarFiltros()">
                <option value="Todos">HistÃ³rico Total</option>
                </select>
        </div>
    </nav>

    <iframe id="janela-aba" src="planilha.html"></iframe>

    <script>
        const nomesMeses = ["","Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];

        function mudarAba(url, btn, mostrarCategoria) {
            document.getElementById('janela-aba').src = url;
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('filtroCat').style.display = mostrarCategoria ? 'block' : 'none';
        }

        function enviarFiltros() {
            const periodo = document.getElementById('filtroPeriodo').value;
            const dados = {
                categoria: document.getElementById('filtroCat').value,
                periodo: periodo // Pode ser "Todos", "2026" (ano) ou "01/2026" (mÃªs)
            };
            document.getElementById('janela-aba').contentWindow.postMessage(dados, '*');
        }

        async function carregarPeriodosDinamicos() {
            const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTVFsO0U3JTeEpqIks1fpNUNiHF5J6Pgyv7yYiJKFgqyI08Y_sRB2nnikRvfT4W5CcwQwAW5r0Lvt1x/pub?output=csv';
            const res = await fetch(url);
            const csv = await res.text();
            
            const anos = new Set();
            const mesesAnos = new Set(); // Para "01/2026"
            
            csv.split('\n').slice(1).forEach(l => {
                const data = l.split(',')[0];
                if(data.includes('/')) {
                    const p = data.split('/');
                    const mes = p[1].trim();
                    const ano = p[2].trim();
                    anos.add(ano);
                    mesesAnos.add(`${mes}/${ano}`);
                }
            });

            const sel = document.getElementById('filtroPeriodo');
            
            // Adiciona Anos primeiro
            Array.from(anos).sort().reverse().forEach(a => {
                sel.innerHTML += `<option value="${a}" style="font-weight:bold; background:#eee;"> Ano ${a}</option>`;
                
                // Adiciona os meses referentes a este ano
                Array.from(mesesAnos).sort().reverse().forEach(ma => {
                    if(ma.endsWith(a)) {
                        const m = ma.split('/')[0];
                        sel.innerHTML += `<option value="${ma}">&nbsp;&nbsp;&nbsp; ${nomesMeses[parseInt(m)]} / ${a}</option>`;
                    }
                });
            });
        }
        carregarPeriodosDinamicos();
    </script>
</body>
</html>