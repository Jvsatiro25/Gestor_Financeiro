<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg-primary: #0a0f1a; --bg-secondary: #111827; --border: #2a3441; --text-primary: #f1f5f9; --accent: #10b981; }
        body { font-family: 'DM Sans', sans-serif; background: var(--bg-primary); padding: 10px; }
        .table-container { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 400px; }
        th { background: #1a2332; padding: 12px 8px; font-size: 10px; color: #94a3b8; text-transform: uppercase; text-align: left; }
        td { padding: 12px 8px; border-bottom: 1px solid var(--border); font-size: 11px; color: var(--text-primary); }
        .col-nome { font-weight: 600; white-space: normal; word-break: break-word; max-width: 110px; }
        .col-tel { font-family: 'JetBrains Mono'; font-size: 9px; color: #64748b; }
        .col-valor { font-family: 'JetBrains Mono'; color: var(--accent); font-weight: 700; }
        .cat-tag { padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: 700; text-transform: uppercase; }
        .cat-Dízimo { background: rgba(16,185,129,0.1); color: #34d399; }
        .cat-Oferta { background: rgba(59,130,246,0.1); color: #60a5fa; }
        @media (max-width: 600px) {
            td, th { padding: 8px 4px; font-size: 10px; }
            .col-tel { display: block; margin-top: 2px; }
        }
    </style>
</head>
<body>
    <div class="table-container">
        <table>
            <thead><tr><th>Data</th><th>Doador / Tel</th><th>Valor</th><th>Cat</th></tr></thead>
            <tbody id="corpoTabela"></tbody>
        </table>
    </div>
    <script>
        const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTVFsO0U3JTeEpqIks1fpNUNiHF5J6Pgyv7yYiJKFgqyI08Y_sRB2nnikRvfT4W5CcwQwAW5r0Lvt1x/pub?output=csv';
        let registros = [];
        const padronizar = t => {
            let n = String(t).replace(/\D/g, "");
            return n.length > 8 ? `(${n.slice(-11,-9)}) ${n.slice(-4)}` : "N/A";
        };

        async function carregar() {
            const res = await fetch(url + '&cache=' + Date.now());
            const csv = await res.text();
            registros = csv.split('\n').slice(1).filter(l=>l.trim()).map(l=>{
                const c = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v=>v.replace(/^"|"$/g,'').trim());
                let [d,m,a] = c[0].split('/');
                return { data: c[0], tel: c[1], nome: c[2].toUpperCase(), valor: c[3], cat: c[4].toLowerCase().includes("dizimo") ? "Dízimo" : c[4], sort: new Date(a, m-1, d), mesAno: `${m}/${a}`, ano: a };
            }).sort((a,b)=>b.sort - a.sort);
            renderizar();
        }

        function renderizar(cat="Todas", periodo="Todos") {
            const f = registros.filter(r => (cat === "Todas" || r.cat === cat) && (periodo === "Todos" || (periodo.length === 4 ? r.ano === periodo : r.mesAno === periodo)));
            document.getElementById('corpoTabela').innerHTML = f.map(r=>`<tr><td>${r.data.slice(0,5)}</td><td><div class="col-nome">${r.nome}</div><div class="col-tel">${padronizar(r.tel)}</div></td><td class="col-valor">${r.valor}</td><td><span class="cat-tag cat-${r.cat}">${r.cat.slice(0,1)}</span></td></tr>`).join('');
        }
        window.addEventListener('message', e => renderizar(e.data.categoria, e.data.periodo));
        carregar();
    </script>
</body>
</html>
